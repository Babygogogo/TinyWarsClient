# AI简述

## 总体架构
AI采用暴力穷举的方式进行运作。预先设定一套评分公式，按照一定顺序在所有部队中挑选出单个部队，对其单个回合内的所有可行行动分别计算分数，取分数最高的行动来执行。不断重复此操作，直至所有部队都行动完毕，最后再建造部队。这种架构的优点是容易实现，局限性在于：
- 棋力直接取决于评分公式、部队行动顺序的合理性
- 由于计算时间有限制，所以每个部队只考虑自身在当前回合的评分，无法考虑多回合、无法考虑复数部队的协同作战（因此无法处理运输部队及阵型排布）
- 在没有合理剪枝（即忽略必然低分的行动）的情况下，计算速度较慢

此外，DOR的CO系统比老三代复杂得多，此AI暂时只考虑最低限度的CO因素。

## 评分公式简述
当前评分公式分为两种，一种针对部队行动，一种针对建造部队。

### 部队行动评分公式
部队行动的评分由两个子评分相加得到，其中一个是位置评分，另一个是动作评分。

#### 位置评分
位置评分即只与部队所处的位置有关的评分，不考虑这个部队是如何来到这个位置、不考虑来到这个位置之前之后做了什么动作。这个评分与以下因素有关：
- 可能受到的来自敌人的单次攻击的最高伤害，伤害越高评分越低（避免无谓伤亡）
    - 会考虑当前地形和我方其他部队对敌军的阻挡。然而不考虑协同作战，所以存在这样一种可能性，即a部队先行动，依靠b部队来阻挡敌军，然后b部队只考虑自身，所以走开了，导致a直接暴露在敌方火力下；或者是b很脆，被摸一下就死了，导致a直接暴露
    - 会考虑敌方弹药、燃料、是否可攻击下潜部队
    - 会考虑自身价值
    - 会考虑自身是否会被单击击毁
    - 会考虑地形对防御的加成
    - 会考虑自身是否搭载了CO，是的话评分更低（保护CO）
    - 会考虑当前我方与敌方的部队总价值比值，若比值大（即我方兵力较强），则评分会增加，反之减少（这使得我方优势时更具侵略性）
    - 不考虑敌我CO加成
    - 不考虑敌方补给
    - 不考虑自身可能受到的多次伤害
    - 不考虑自身是否会被多击击毁
    - 不考虑地形变化（陨石等离子被击破、海港被占领、等等）
    - 不考虑敌方视野
    - 不考虑敌方的高威胁单位同时看住多个位置的情况（比如敌军只有一个AA，也会导致AI的一百个BC都不敢上）

- 与最近的非我方的建筑的距离，越近则评分越高（避免止步不前）

- 与敌方部队的距离，越近则评分越高（避免止步不前）

- 我方部队在该位置上是否会得到补给维修，是则加分
    - 会考虑地形的维修补给
    - 会考虑Rig的补给，但同样存在不考虑协同作战所带来的Rig离场问题
    - 会考虑当前hp和弹药燃料，也就是说如果本来就不缺，那么补给维修也就不会加分
    - 会考虑部队是否会耗尽燃料而自毁，是的话则补给分有额外加成
    - 不考虑CO的维修补给能力

- 是否占用了我方的工厂、机场、海港，是则减分

- 是否占用了敌方的工厂、机场、海港，是则加分

#### 动作评分
动作评分即只与部队所进行的动作有关，不考虑其处在什么位置。以下简述各种动作所考虑的因素：
- 装载
    - 考虑容器部队是否能弹射其内容物（目前只有航母可以弹射）。若否，则直接评极低分（因为AI没有计算卸载评分的能力，所以使用极低分避免装载）
    - 考虑容器部队是否能够维修补给其内容物，能则加分
    - 不考虑CO加成

- 合流
    - 考虑目标部队是否已行动，若未行动，给出极低分
    - 考虑合流所得HP是否溢出，若是，则分数比未溢出的要低
    - 考虑目标部队是否正在进行占领，是则分数有额外加成
    - 不考虑CO加成

- 攻击
    - 考虑我方与敌方的部队总价值比值，比值越大则评分越高
    - 考虑敌方价值，价值越高则评分越高
    - 考虑伤害值，值越高评分越高
    - 考虑是否构成击杀，是则评分增高
    - 考虑敌方部队是否搭载了CO，是则评分增高
    - 考虑敌方是否正在占领建筑，是则评分增高
    - 考虑敌方反击伤害，伤害越高则评分越低；同样考虑是否构成反杀、敌我部队总价值比值、是否搭载CO等
    - 不考虑敌我CO加成

- 占领
    - 考虑是否能立刻完成占领，是则给极高分
    - 考虑是否能三回合内完成占领（不考虑hp变化），否则给较低分
    - 考虑建筑类别
    - 不考虑CO加成

- 下潜
    - 仅考虑当前燃料，低则减分，否则加分

- 发射导弹
    - 基础分就很高（也就是让发射导弹优先于其他动作）
    - 考虑造成的敌我伤害，敌方伤害越高分数越高，我方相反

- 上浮
    - 仅考虑当前燃料，低则加分，否则减分

- 待机
    - 考虑所在地形是否敌方建筑，是则扣分

### 建造部队评分公式
主要考虑生产的部队对于当前局面能起到多少作用。当然，这个描述非常模糊不清无法真正编程，所以实际上只考虑了以下因素：
- 考虑在可能的情况下，决不空工场。在钱只够每个工场生产一个inf的条件下（或甚至连这都不够的时候），生产其他任何部队的评分都会降到极低
- 考虑当前我方存在的与生产目标部队相同种类的部队的总价值，总价值越高，评分越低（避免AI只生产某几种部队）
- 考虑目标部队对敌方所有部队所能造成的基础伤害对应的总价值，总价值越高评分越高
- 考虑目标部队会被敌方所有部队造成的基础伤害的总价值，总价值越高评分越低
- 不考虑部队与敌我CO的相性

## AI行动顺序
AI固定先移动所有部队，再制造新部队。

### 部队行动
部队行动分为以下几个阶段，按顺序执行：
- 随机挑选远程部队，并计算其最高分的行动。如果这个行动是发起攻击，那么直接执行，否则跳过。不断循环，直至所有远程部队都被计算过。

- 随机挑选正在执行占领操作的步兵系，计算并执行其最高分的行动，不断循环直至全部都行动过。

- 随机挑选剩余的步兵系，计算并执行最高分的行动，不断循环直至全部都行动过。

- 随机挑选空军战斗单位，计算并执行最高分的行动，不断循环直至全部都行动过。

- 随机挑选剩余的近战部队，计算并执行最高分的行动，不断循环直至全部都行动过。

- 随机挑选剩余的非远程部队，计算并执行最高分的行动，不断循环直至全部都行动过。

- 随机挑选剩余的所有部队，计算并执行最高分的行动，不断循环直至全部都行动过。

### 建造部队
建造部队是针对当前可用的所有建筑，分别计算其可能造出的所有部队的评分，选取最高分的来执行；不断重复此步骤，直至没钱或者没建筑可用为止。
